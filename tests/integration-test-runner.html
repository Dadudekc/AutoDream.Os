<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Integration Test Runner - V2 Compliance Validation</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .test-controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        button {
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn-primary {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        .btn-secondary {
            background: linear-gradient(45deg, #9C88FF, #6C5CE7);
            color: white;
        }
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        .btn-success {
            background: linear-gradient(45deg, #00B894, #00CEC9);
            color: white;
        }
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        .test-results {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .progress-bar {
            width: 100%;
            height: 30px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            margin: 20px 0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #00B894, #00CEC9);
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .status-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .status-running {
            background: #FFD93D;
            animation: pulse 1s infinite;
        }
        .status-success {
            background: #00B894;
        }
        .status-error {
            background: #FF6B6B;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .summary-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .metric {
            text-align: center;
        }
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .metric-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ System Integration Test Runner</h1>
        <p style="text-align: center; margin-bottom: 30px; font-size: 1.2em;">
            Comprehensive testing for all modular components - V2 Compliance Validation
        </p>

        <div class="test-controls">
            <button id="runTestsBtn" class="btn-primary">
                üöÄ Run All Integration Tests
            </button>
            <button id="clearResultsBtn" class="btn-secondary">
                üßπ Clear Results
            </button>
            <button id="exportReportBtn" class="btn-success">
                üìä Export Report
            </button>
        </div>

        <div id="statusIndicator">
            <span class="status-indicator" id="statusDot"></span>
            <span id="statusText">Ready to run tests</span>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill">
                <span id="progressText">0%</span>
            </div>
        </div>

        <div class="summary-card" id="summaryCard" style="display: none;">
            <div class="metric">
                <div class="metric-value" id="totalTests">0</div>
                <div class="metric-label">Total Tests</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="passedTests">0</div>
                <div class="metric-label">Passed</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="failedTests">0</div>
                <div class="metric-label">Failed</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="successRate">0%</div>
                <div class="metric-label">Success Rate</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="duration">0ms</div>
                <div class="metric-label">Duration</div>
            </div>
        </div>

        <div class="test-results" id="testResults">
            <div style="text-align: center; opacity: 0.7;">
                Test results will appear here...
            </div>
        </div>
    </div>

    <!-- Load the modular components -->
    <script type="module" src="src/web/static/js/framework/components.js"></script>
    <script type="module" src="src/web/static/js/framework/navigation.js"></script>
    <script type="module" src="src/web/static/js/framework/modal.js"></script>
    <script type="module" src="src/web/static/js/framework/forms.js"></script>
    <script type="module" src="src/web/static/js/framework/ui-components.js"></script>

    <!-- Load the integration test suite -->
    <script type="module">
        import { SystemIntegrationTestSuite } from './src/web/static/js/framework/system-integration-test.js';

        // Initialize test runner
        class TestRunner {
            constructor() {
                this.testSuite = null;
                this.isRunning = false;
                this.initializeEventListeners();
            }

            initializeEventListeners() {
                document.getElementById('runTestsBtn').addEventListener('click', () => this.runTests());
                document.getElementById('clearResultsBtn').addEventListener('click', () => this.clearResults());
                document.getElementById('exportReportBtn').addEventListener('click', () => this.exportReport());
            }

            async runTests() {
                if (this.isRunning) return;

                this.isRunning = true;
                this.updateStatus('running', 'Running integration tests...');
                this.resetProgress();

                try {
                    this.testSuite = new SystemIntegrationTestSuite();

                    // Override the log method to update UI
                    const originalLog = console.log;
                    console.log = (...args) => {
                        originalLog.apply(console, args);
                        this.updateTestResults(args.join(' '));
                    };

                    // Override generateTestReport to capture results
                    const originalGenerateReport = this.testSuite.generateTestReport.bind(this.testSuite);
                    this.testSuite.generateTestReport = () => {
                        const results = originalGenerateReport();
                        this.displayTestSummary(results);
                        return results;
                    };

                    await this.testSuite.runAllTests();

                    this.updateStatus('success', 'Tests completed successfully!');
                    console.log = originalLog;

                } catch (error) {
                    console.error('‚ùå Test execution failed:', error);
                    this.updateStatus('error', 'Tests failed with error');
                    this.updateTestResults(`‚ùå CRITICAL ERROR: ${error.message}`);
                } finally {
                    this.isRunning = false;
                }
            }

            updateStatus(status, text) {
                const statusDot = document.getElementById('statusDot');
                const statusText = document.getElementById('statusText');

                statusDot.className = 'status-indicator status-' + status;
                statusText.textContent = text;
            }

            updateProgress(percent) {
                const progressFill = document.getElementById('progressFill');
                const progressText = document.getElementById('progressText');

                progressFill.style.width = percent + '%';
                progressText.textContent = percent + '%';
            }

            resetProgress() {
                this.updateProgress(0);
                document.getElementById('summaryCard').style.display = 'none';
            }

            updateTestResults(text) {
                const resultsDiv = document.getElementById('testResults');
                const newResult = document.createElement('div');
                newResult.textContent = text;
                resultsDiv.appendChild(newResult);
                resultsDiv.scrollTop = resultsDiv.scrollHeight;

                // Update progress based on test completion
                const totalTests = 10; // We have 10 test methods
                const completedTests = resultsDiv.children.length - 1; // Subtract the initial message
                const progress = Math.min((completedTests / totalTests) * 100, 100);
                this.updateProgress(Math.round(progress));
            }

            displayTestSummary(results) {
                document.getElementById('summaryCard').style.display = 'grid';
                document.getElementById('totalTests').textContent = results.totalTests;
                document.getElementById('passedTests').textContent = results.passedTests;
                document.getElementById('failedTests').textContent = results.failedTests;
                document.getElementById('successRate').textContent = results.successRate.toFixed(1) + '%';
                document.getElementById('duration').textContent = results.duration + 'ms';

                this.updateProgress(100);
            }

            clearResults() {
                const resultsDiv = document.getElementById('testResults');
                resultsDiv.innerHTML = '<div style="text-align: center; opacity: 0.7;">Test results will appear here...</div>';
                this.resetProgress();
                this.updateStatus('ready', 'Ready to run tests');
            }

            exportReport() {
                if (!this.testSuite) {
                    alert('No test results available. Please run tests first.');
                    return;
                }

                const report = {
                    timestamp: new Date().toISOString(),
                    testSuite: 'System Integration Test Suite',
                    results: this.testSuite.testResults,
                    summary: {
                        totalTests: this.testSuite.testResults.length,
                        passedTests: this.testSuite.testResults.filter(r => r.passed).length,
                        failedTests: this.testSuite.testResults.filter(r => !r.passed).length,
                        successRate: (this.testSuite.testResults.filter(r => r.passed).length / this.testSuite.testResults.length * 100).toFixed(2) + '%',
                        duration: this.testSuite.testEndTime - this.testSuite.testStartTime + 'ms'
                    }
                };

                const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `integration-test-report-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }

        // Initialize the test runner when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            new TestRunner();
            console.log('üéØ System Integration Test Runner initialized');
            console.log('Click "Run All Integration Tests" to begin comprehensive testing');
        });
    </script>
</body>
</html>
