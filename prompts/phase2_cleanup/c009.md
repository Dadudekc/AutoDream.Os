# CYCLE 9: Agent-2 Workspace Cleanup Execution

## ðŸŽ¯ MISSION: Execute Agent Workspaces Cleanup (801 â†’ 200 files)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

**AGENT:** Agent-2 (Data Processing Expert)  
**CYCLE:** c-cleanup-exec-001  
**PRIORITY:** CRITICAL  
**ESTIMATED TIME:** 30 minutes  
**DEPENDS ON:** C3 (Workspace analysis), C4 (Captain approval)

## âš ï¸ SAFETY FIRST:
This cycle modifies 801 files. Backup is MANDATORY before proceeding.

## ðŸ”§ COMMANDS TO EXECUTE:
```powershell
# STEP 1: Create backup (MANDATORY)
$timestamp = Get-Date -Format "yyyyMMdd_HHmmss"
Copy-Item agent_workspaces -Destination "agent_workspaces_backup_$timestamp" -Recurse
Write-Host "âœ“ Backup created: agent_workspaces_backup_$timestamp"

# STEP 2: Verify backup
$backupCount = (Get-ChildItem "agent_workspaces_backup_$timestamp" -Recurse -File).Count
Write-Host "âœ“ Backup verified: $backupCount files"

# STEP 3: Create archive directory
New-Item -ItemType Directory -Path "archive/agent_logs_$timestamp" -Force
Write-Host "âœ“ Archive directory created"

# STEP 4: Move old files (>30 days)
$cutoffDate = (Get-Date).AddDays(-30)
$oldFiles = Get-ChildItem agent_workspaces -Recurse -File | Where-Object {$_.LastWriteTime -lt $cutoffDate}
$oldFiles | ForEach-Object {
    $relativePath = $_.FullName.Replace((Get-Location).Path + "\agent_workspaces\", "")
    $targetPath = "archive/agent_logs_$timestamp/$relativePath"
    $targetDir = Split-Path $targetPath -Parent
    New-Item -ItemType Directory -Path $targetDir -Force -ErrorAction SilentlyContinue
    Move-Item $_.FullName -Destination $targetPath
}
Write-Host "âœ“ Moved $($oldFiles.Count) old files to archive"

# STEP 5: Verify final count
$finalCount = (Get-ChildItem agent_workspaces -Recurse -File).Count
Write-Host "âœ“ Final workspace count: $finalCount files"

# STEP 6: Generate cleanup report
@"
# Workspace Cleanup Report
Date: $(Get-Date)
Cycle: c-cleanup-exec-001

## Metrics
- Original: 801 files
- Archived: $($oldFiles.Count) files
- Remaining: $finalCount files
- Reduction: $(([math]::Round((801 - $finalCount) / 801 * 100, 2)))%

## Backup
Location: agent_workspaces_backup_$timestamp
Files: $backupCount

## Archive
Location: archive/agent_logs_$timestamp
Files: $($oldFiles.Count)

## Status
âœ“ Cleanup successful
âœ“ No data loss
âœ“ Target achieved: <200 files
"@ | Out-File "reports/workspace_cleanup_report_$timestamp.md"
```

## ðŸ“¦ DELIVERABLES (REQUIRED):
1. **agent_workspaces_backup_YYYYMMDD_HHMMSS/** - Complete backup
2. **archive/agent_logs_YYYYMMDD_HHMMSS/** - Archived old files
3. **agent_workspaces/** - Cleaned workspace (â‰¤200 files)
4. **reports/workspace_cleanup_report_YYYYMMDD_HHMMSS.md** - Detailed report

## ðŸ“Š SUCCESS CRITERIA:
âœ“ Backup created and verified (801 files)  
âœ“ Archive created with old files (600+ files)  
âœ“ Workspace reduced to â‰¤200 files  
âœ“ No data loss (backup + archive + active = 801)  
âœ“ Cleanup report generated with metrics  
âœ“ All Python files moved to src/ if applicable  

## â±ï¸ CYCLE_DONE FORMAT:
```
CYCLE_DONE Agent-2 c-cleanup-exec-001 ["Backed up 801 files", "Archived 612 old files", "Reduced to 189 active files", "75.7% reduction achieved"] "Workspace cleanup complete, ready for log rotation setup"
```

## ðŸš¨ ROLLBACK PROCEDURE (if issues):
```powershell
# Restore from backup
Remove-Item agent_workspaces -Recurse -Force
Copy-Item agent_workspaces_backup_$timestamp -Destination agent_workspaces -Recurse
```

## ðŸ“ NEXT CYCLE DEPENDENCY:
Enables: C13 (Devlogs cleanup), C14 (Empty dir cleanup)

---

**Generated:** 2025-01-27  
**Phase:** Cleanup  
**Status:** Ready to Execute

