# üéØ UNIFIED AGENT KNOWLEDGE SYSTEM - PROPOSAL

**Agent:** Agent-1 - Testing & QA Specialist  
**Date:** 2025-10-15  
**Problem:** Agent knowledge is SCATTERED across 5+ systems with ZERO integration  
**Solution:** Create SINGLE SOURCE OF TRUTH for "What Agents Should Know"

---

## üö® **THE PROBLEM (CONFIRMED)**

**Current Reality:**
- ‚ö†Ô∏è Swarm brain (minimal coverage)
- ‚ùå FSM (not documented at all)
- ‚ùå Toolbelt (not documented at all)
- ‚ùå Database (not documented at all)
- ‚ùå **CYCLE workflows** (not documented at all) ‚ö° **CORRECTED!**
- ‚úÖ Onboarding (good but one-time only)

**Result:** 
- Agents told ONCE during onboarding
- Never reminded
- No reference system
- Knowledge scattered
- Agents forget critical requirements (like status.json updates!)

---

## üéØ **THE SOLUTION: 3-TIER UNIFIED SYSTEM**

### **ARCHITECTURE:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  TIER 1: SWARM BRAIN (Master Knowledge Base)                ‚îÇ
‚îÇ  Single Source of Truth - All agent knowledge centralized   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  TIER 2: CYCLE-BASED PROTOCOLS (Active Reminders)           ‚îÇ
‚îÇ  Every cycle enforcement via automated systems              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  TIER 3: AUTOMATED ENFORCEMENT (No Human Memory Needed)      ‚îÇ
‚îÇ  Code enforces knowledge, agents can't forget               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìã **TIER 1: SWARM BRAIN CONSOLIDATION** ‚≠ê **CRITICAL**

### **Proposal: Create "Agent Field Manual" in Swarm Brain**

**Structure:**
```
swarm_brain/
‚îú‚îÄ‚îÄ agent_field_manual/
‚îÇ   ‚îú‚îÄ‚îÄ 00_MASTER_INDEX.md                    (All topics indexed)
‚îÇ   ‚îú‚îÄ‚îÄ 01_AGENT_LIFECYCLE.md                 (States, transitions, FSM)
‚îÇ   ‚îú‚îÄ‚îÄ 02_CYCLE_PROTOCOLS.md                 (What to do EVERY cycle)
‚îÇ   ‚îú‚îÄ‚îÄ 03_STATUS_JSON_COMPLETE_GUIDE.md      (Comprehensive)
‚îÇ   ‚îú‚îÄ‚îÄ 04_TOOLBELT_USAGE.md                  (All 41 tools + protocols)
‚îÇ   ‚îú‚îÄ‚îÄ 05_DATABASE_INTEGRATION.md            (DB sync requirements)
‚îÇ   ‚îú‚îÄ‚îÄ 06_MESSAGING_PROTOCOLS.md             (How to communicate)
‚îÇ   ‚îú‚îÄ‚îÄ 07_GAS_SYSTEM.md                      (Prompts are gas explained)
‚îÇ   ‚îú‚îÄ‚îÄ 08_MISSION_EXECUTION.md               (How to execute missions)
‚îÇ   ‚îú‚îÄ‚îÄ 09_QUALITY_STANDARDS.md               (V2, testing, compliance)
‚îÇ   ‚îú‚îÄ‚îÄ 10_SWARM_COORDINATION.md              (Multi-agent protocols)
‚îÇ   ‚îî‚îÄ‚îÄ 99_QUICK_REFERENCE.md                 (One-page cheat sheet)
```

**Key Features:**
- ‚úÖ **COMPREHENSIVE** - Every topic agents need
- ‚úÖ **INDEXED** - Easy to search/find
- ‚úÖ **VERSIONED** - Track changes over time
- ‚úÖ **ACCESSIBLE** - Via swarm_brain API
- ‚úÖ **MAINTAINED** - Single place to update

---

### **SPECIFIC FILE: 02_CYCLE_PROTOCOLS.md** ‚ö°

**Purpose:** What agents MUST do EVERY cycle (not "daily" - CYCLE-BASED!)

**Contents:**
```markdown
# CYCLE PROTOCOLS - MANDATORY EVERY CYCLE

## üìä WHAT IS A CYCLE?
- **1 CYCLE = 1 Captain prompt + 1 Agent response**
- NOT time-based! CYCLE-based!
- Frequency: Every Captain interaction

---

## ‚úÖ START OF CYCLE (MANDATORY):

### 1. CHECK INBOX
python -m src.services.messaging_cli --agent Agent-X --check-inbox

### 2. UPDATE STATUS.JSON
- Set status: "ACTIVE"
- Set current_mission: "[mission name]"
- Set current_phase: "[current phase]"
- Set last_updated: [ISO 8601 timestamp]
- Set fsm_state: "active" (see FSM guide)

Command:
python tools/update_status.py --agent Agent-X --status ACTIVE --mission "[name]"

### 3. SYNC TO DATABASE
python tools/sync_status_to_db.py --agent Agent-X

---

## üîÑ DURING CYCLE (AS NEEDED):

### 1. Update status.json when phase changes
- Starting new subtask ‚Üí update current_phase
- Blocked ‚Üí update status to "BLOCKED", add blockers array
- Waiting ‚Üí update status to "WAITING"

### 2. Use toolbelt tools
- Before tool use ‚Üí update status.json
- After tool use ‚Üí update status.json

### 3. Send messages
- Document in status.json: messages_sent count
- Update last_activity timestamp

---

## ‚úÖ END OF CYCLE (MANDATORY):

### 1. UPDATE STATUS.JSON FINAL STATE
- Set completed_tasks: [add latest task]
- Set next_actions: [what's next]
- Set points_earned: [this cycle points]
- Set last_updated: [ISO 8601 timestamp]

### 2. COMMIT STATUS.JSON
git add agent_workspaces/Agent-X/status.json
git commit -m "status: Agent-X cycle [N] complete"

### 3. CREATE DEVLOG (if significant work)
echo "# Agent-X Cycle [N]..." > devlogs/[timestamp]_agent-x_[topic].md

### 4. SYNC TO DATABASE
python tools/sync_status_to_db.py --agent Agent-X

---

## üö® VIOLATIONS:

**What happens if you DON'T follow cycle protocols:**
1. Captain can't track your state
2. Fuel monitor thinks you're idle
3. Integrity validator flags you
4. Discord bot shows stale state
5. Other agents can't coordinate with you

**Enforcement:**
- Automated checks every cycle
- Alerts sent to your inbox
- Captain notified of violations
```

---

### **SPECIFIC FILE: 03_STATUS_JSON_COMPLETE_GUIDE.md** ‚≠ê

**Purpose:** Everything about status.json in ONE place

**Contents:**
```markdown
# STATUS.JSON - COMPLETE GUIDE

## üìã WHAT IT IS
- **Single Source of Truth** for agent state
- **Read by:** 15+ tools, Captain, Discord bot, Fuel monitor, Integrity validator
- **Frequency:** Update EVERY cycle
- **Location:** agent_workspaces/Agent-X/status.json

## üîç WHO READS IT
1. Captain Agent-4 (EVERY cycle - finds idle agents)
2. Discord bot (!status, !livestatus commands)
3. Fuel monitor (determines GAS delivery)
4. Integrity validator (audits claims)
5. Swarm orchestrator (mission assignment)
6. Swarm state reader (swarm-wide state)
7. Captain tools (idle detection, monitoring)
8. Database sync (agent_workspaces table)

## üìä REQUIRED FIELDS

### Always Required:
- agent_id: "Agent-X"
- agent_name: "[Role]"
- status: "ACTIVE|IDLE|BLOCKED|WAITING|COMPLETE"
- current_phase: "[Current work phase]"
- last_updated: "[ISO 8601 timestamp]"
- current_mission: "[Mission description]"
- mission_priority: "CRITICAL|HIGH|MEDIUM|LOW"

### FSM Integration:
- fsm_state: "start|active|process|blocked|complete|end"
  (See FSM guide for valid states)

### Cycle Tracking:
- cycle_count: [number of cycles this session]
- last_cycle: "[ISO 8601 timestamp]"

### Work Tracking:
- current_tasks: ["Task 1", "Task 2", ...]
- completed_tasks: ["Done 1", "Done 2", ...]
- achievements: ["Achievement 1", ...]
- points_earned: [number]

### Planning:
- next_actions: ["Next 1", "Next 2", ...]
- next_milestone: "[Description]"
- last_milestone: "[Description]"

### Blockers (if applicable):
- blockers: ["Blocker 1", "Blocker 2", ...]
- status: "BLOCKED" (when blockers exist)

## üîÑ WHEN TO UPDATE

### EVERY CYCLE START:
- Update last_updated
- Update status to "ACTIVE"
- Update current_mission (if new)
- Update cycle_count (increment)

### DURING CYCLE:
- Phase change ‚Üí update current_phase
- Start subtask ‚Üí add to current_tasks
- Complete subtask ‚Üí move to completed_tasks, add points
- Get blocked ‚Üí update status to "BLOCKED", add to blockers
- Use tool ‚Üí update current_phase

### EVERY CYCLE END:
- Update completed_tasks
- Update next_actions
- Update last_updated
- Commit to git

### SPECIAL EVENTS:
- New mission ‚Üí update current_mission, mission_priority, current_phase
- Mission complete ‚Üí update status to "COMPLETE", add to achievements
- Emergency ‚Üí update status, add to blockers
- Debate vote ‚Üí update current_phase

## üíª HOW TO UPDATE

### Option 1: Manual (Quick)
```bash
# Edit directly
nano agent_workspaces/Agent-X/status.json

# Update last_updated, status, etc.
```

### Option 2: Python Script (Recommended)
```python
import json
from datetime import datetime

status_path = "agent_workspaces/Agent-X/status.json"
with open(status_path, 'r') as f:
    status = json.load(f)

status['last_updated'] = datetime.utcnow().isoformat() + 'Z'
status['status'] = 'ACTIVE'
status['current_phase'] = 'Executing mission'
status['cycle_count'] = status.get('cycle_count', 0) + 1

with open(status_path, 'w') as f:
    json.dump(status, f, indent=2)
```

### Option 3: Helper Tool (Best)
```bash
python tools/update_status.py \
  --agent Agent-X \
  --status ACTIVE \
  --mission "Mission name" \
  --phase "Current phase" \
  --increment-cycle
```

## üìù EXAMPLES BY USE CASE

### Starting New Mission:
```json
{
  "status": "ACTIVE",
  "current_mission": "Analyze repos 1-10",
  "mission_priority": "HIGH",
  "current_phase": "Repo 1 analysis in progress",
  "fsm_state": "active",
  "current_tasks": ["Clone repo 1", "Read README", "Analyze purpose"],
  "last_updated": "2025-10-15T12:00:00Z"
}
```

### Completing Subtask:
```json
{
  "current_phase": "Repo 2 analysis in progress",
  "current_tasks": ["Clone repo 2", "Read README"],
  "completed_tasks": ["Repo 1 complete", "Devlog posted"],
  "points_earned": 100,
  "last_updated": "2025-10-15T13:00:00Z"
}
```

### Being Blocked:
```json
{
  "status": "BLOCKED",
  "current_phase": "Waiting for Captain decision",
  "blockers": ["Need approval for archival decision", "Waiting for debate results"],
  "next_actions": ["Wait for Captain", "Review debate when complete"],
  "last_updated": "2025-10-15T14:00:00Z"
}
```

### Mission Complete:
```json
{
  "status": "COMPLETE",
  "current_mission": "Analyze repos 1-10 - COMPLETE",
  "mission_priority": "COMPLETE",
  "current_phase": "All 9 repos analyzed, awaiting next mission",
  "fsm_state": "complete",
  "completed_tasks": ["All 9 repos analyzed", "9 devlogs posted", "Final report sent"],
  "achievements": ["First multi-repo analysis", "Found critical contradiction in Agent-2 audit"],
  "points_earned": 800,
  "next_actions": ["Await Captain's next assignment"],
  "last_updated": "2025-10-15T15:00:00Z"
}
```

## üîó DATABASE SYNC

**Important:** status.json syncs to database!

**Tables Affected:**
1. `agent_workspaces` table
   - Columns: status, last_updated, current_focus, cycle_count
   
2. `agent_status` table (vector DB)
   - Stores embeddings of status for semantic search

**Sync Command:**
```bash
python tools/sync_status_to_db.py --agent Agent-X
```

**Auto-sync:** Happens automatically when using update_status.py tool

## ‚ö†Ô∏è COMMON MISTAKES

### ‚ùå DON'T:
- Forget to update last_updated timestamp
- Use time-based estimates ("2 hours left")
- Leave status.json unchanged for multiple cycles
- Update without committing to git
- Forget to sync to database

### ‚úÖ DO:
- Update EVERY cycle
- Use cycle-based tracking
- Commit after updates
- Use ISO 8601 timestamps
- Sync to database

## üö® CONSEQUENCES OF NOT UPDATING

1. **Captain can't find you** - Won't assign new work
2. **Fuel monitor thinks you're idle** - Won't deliver GAS
3. **Discord bot shows stale state** - Team thinks you're inactive
4. **Integrity validator flags you** - Audit fails
5. **Database out of sync** - Analytics broken
6. **Other agents can't coordinate** - Swarm coordination breaks

**BOTTOM LINE: Update status.json EVERY cycle!**
```

---

## üìã **TIER 2: CYCLE-BASED AUTOMATED REMINDERS** ‚ö°

### **Proposal: Cycle Checkpoint System**

**Implementation:**

#### **1. Pre-Cycle Hook**
**File:** `tools/cycle_hooks/pre_cycle_check.py`

**Functionality:**
```python
"""
Runs BEFORE agent starts new cycle
Checks and reminds agent of requirements
"""

def pre_cycle_check(agent_id: str):
    """Check agent readiness for new cycle."""
    
    # Check 1: Status.json exists
    status_path = f"agent_workspaces/{agent_id}/status.json"
    if not exists(status_path):
        alert_agent(agent_id, "CRITICAL: status.json missing!")
        create_default_status(agent_id)
    
    # Check 2: Status.json not stale
    last_updated = get_last_updated(agent_id)
    if is_stale(last_updated, threshold_cycles=2):
        alert_agent(agent_id, f"WARNING: status.json stale ({cycles} cycles old)")
    
    # Check 3: Inbox not empty
    inbox_count = count_inbox_messages(agent_id)
    if inbox_count > 0:
        alert_agent(agent_id, f"REMINDER: {inbox_count} messages in inbox")
    
    # Send reminder
    send_cycle_reminder(agent_id, cycle_protocols_checklist())
```

**Delivery:**
```markdown
üìã CYCLE START CHECKLIST - Agent-X

Before you begin this cycle:
[ ] Check inbox (3 messages waiting)
[ ] Update status.json (last update: 2 cycles ago - STALE!)
[ ] Review current mission
[ ] Set status to ACTIVE

See: swarm_brain/agent_field_manual/02_CYCLE_PROTOCOLS.md
```

---

#### **2. Post-Cycle Hook**
**File:** `tools/cycle_hooks/post_cycle_check.py`

**Functionality:**
```python
"""
Runs AFTER agent completes cycle
Validates cycle completion
"""

def post_cycle_check(agent_id: str):
    """Validate cycle completion."""
    
    # Check 1: Status.json updated this cycle
    if not updated_this_cycle(agent_id):
        alert_captain(f"{agent_id} didn't update status.json this cycle!")
        alert_agent(agent_id, "VIOLATION: Didn't update status.json!")
    
    # Check 2: Work committed to git
    if has_uncommitted_status(agent_id):
        alert_agent(agent_id, "REMINDER: Commit status.json to git")
    
    # Check 3: Database synced
    if not db_synced(agent_id):
        auto_sync_to_db(agent_id)
    
    # Generate cycle report
    cycle_report = generate_cycle_report(agent_id)
    save_to_history(agent_id, cycle_report)
```

---

#### **3. Captain Cycle Monitor**
**File:** `tools/captain/cycle_monitor.py`

**Functionality:**
```python
"""
Captain's automated monitoring system
Runs EVERY cycle for all agents
"""

def monitor_all_agents():
    """Monitor all 8 agents every cycle."""
    
    violations = []
    
    for agent_id in SWARM_AGENTS:
        # Check status.json freshness
        if is_stale(agent_id):
            violations.append(f"{agent_id}: Stale status.json")
        
        # Check cycle protocols compliance
        if not followed_cycle_protocols(agent_id):
            violations.append(f"{agent_id}: Didn't follow cycle protocols")
        
        # Check database sync
        if not db_synced(agent_id):
            violations.append(f"{agent_id}: DB out of sync")
    
    # Alert Captain
    if violations:
        send_to_captain_inbox("CYCLE_VIOLATIONS.md", violations)
```

---

## üìã **TIER 3: AUTOMATED ENFORCEMENT** ü§ñ

### **Proposal: Code-Level Enforcement (Agents CAN'T Forget)**

#### **1. Status Update Wrapper**
**File:** `src/core/agent_lifecycle.py`

**Functionality:**
```python
"""
All agent actions automatically update status.json
NO manual updates needed!
"""

class AgentLifecycle:
    """Manages agent lifecycle with automatic status updates."""
    
    def __init__(self, agent_id: str):
        self.agent_id = agent_id
        self.status_manager = StatusManager(agent_id)
    
    def start_cycle(self):
        """Automatically updates status.json on cycle start."""
        self.status_manager.update({
            'status': 'ACTIVE',
            'last_updated': utcnow(),
            'cycle_count': self.get_cycle_count() + 1
        })
        self.status_manager.sync_to_db()
    
    def start_mission(self, mission_name: str, priority: str):
        """Automatically updates status.json when mission starts."""
        self.status_manager.update({
            'current_mission': mission_name,
            'mission_priority': priority,
            'current_phase': 'Mission started',
            'fsm_state': 'active',
            'last_updated': utcnow()
        })
        self.status_manager.sync_to_db()
    
    def complete_task(self, task_name: str, points: int):
        """Automatically updates status.json when task completes."""
        self.status_manager.add_completed_task(task_name)
        self.status_manager.add_points(points)
        self.status_manager.update({'last_updated': utcnow()})
        self.status_manager.sync_to_db()
    
    def end_cycle(self):
        """Automatically updates status.json on cycle end."""
        self.status_manager.update({'last_updated': utcnow()})
        self.status_manager.commit_to_git()
        self.status_manager.sync_to_db()
```

**Usage (Agents use this instead of manual updates):**
```python
from src.core.agent_lifecycle import AgentLifecycle

lifecycle = AgentLifecycle('Agent-1')

# Cycle start - automatic status update!
lifecycle.start_cycle()

# Mission start - automatic status update!
lifecycle.start_mission("Analyze repos 1-10", "HIGH")

# Task complete - automatic status update!
lifecycle.complete_task("Repo 1 analyzed", points=100)

# Cycle end - automatic status update + commit + DB sync!
lifecycle.end_cycle()
```

**Benefit:** Agents CANNOT forget to update - it's automatic!

---

#### **2. Messaging Integration**
**File:** `src/services/messaging_cli.py`

**Enhancement:**
```python
"""
Every message sent/received automatically updates status.json
"""

def send_message(agent_id, message, **kwargs):
    """Send message with automatic status update."""
    
    # Send message
    result = _send_message_impl(agent_id, message, **kwargs)
    
    # Auto-update status.json
    lifecycle = AgentLifecycle(agent_id)
    lifecycle.record_activity('message_sent', {
        'to': kwargs.get('recipient'),
        'type': kwargs.get('type'),
        'timestamp': utcnow()
    })
    
    return result
```

---

#### **3. Tool Usage Wrapper**
**File:** `tools_v2/core/tool_wrapper.py`

**Functionality:**
```python
"""
Every tool use automatically updates status.json
"""

def execute_tool(agent_id, tool_name, params):
    """Execute tool with automatic status update."""
    
    lifecycle = AgentLifecycle(agent_id)
    
    # Before tool execution
    lifecycle.update_phase(f"Using tool: {tool_name}")
    
    # Execute tool
    result = _execute_tool_impl(tool_name, params)
    
    # After tool execution
    lifecycle.record_activity('tool_used', {
        'tool': tool_name,
        'result': result.success,
        'timestamp': utcnow()
    })
    lifecycle.update_phase(f"Tool {tool_name} complete")
    
    return result
```

---

## üóÇÔ∏è **IMPLEMENTATION PLAN**

### **Phase 1: Swarm Brain Consolidation** (Cycles 1-3)
**Goal:** Create Agent Field Manual

**Tasks:**
1. Create `swarm_brain/agent_field_manual/` directory
2. Write 00_MASTER_INDEX.md
3. Write 01_AGENT_LIFECYCLE.md (FSM integration)
4. Write 02_CYCLE_PROTOCOLS.md ‚ö° (CYCLE-based, not daily!)
5. Write 03_STATUS_JSON_COMPLETE_GUIDE.md
6. Write 04_TOOLBELT_USAGE.md (all 41 tools)
7. Write 05_DATABASE_INTEGRATION.md
8. Write 06-10 remaining guides
9. Write 99_QUICK_REFERENCE.md (one-page cheat sheet)
10. Update swarm_brain/knowledge_base.json with all guides

**Success Criteria:**
- [ ] All 11 guides created
- [ ] Indexed and searchable
- [ ] Accessible via SwarmMemory API
- [ ] One source of truth established

---

### **Phase 2: Cycle-Based Reminders** (Cycles 4-6)
**Goal:** Automated checkpoint system

**Tasks:**
1. Create `tools/cycle_hooks/` directory
2. Implement pre_cycle_check.py
3. Implement post_cycle_check.py
4. Implement captain/cycle_monitor.py
5. Integrate with messaging system
6. Test with all 8 agents
7. Deploy to production

**Success Criteria:**
- [ ] Pre-cycle reminders sent automatically
- [ ] Post-cycle validations run automatically
- [ ] Captain notified of violations
- [ ] All agents receive checklist every cycle

---

### **Phase 3: Automated Enforcement** (Cycles 7-10)
**Goal:** Code-level enforcement

**Tasks:**
1. Create src/core/agent_lifecycle.py
2. Create StatusManager class
3. Wrap messaging_cli with auto-updates
4. Wrap tool execution with auto-updates
5. Update onboarding to use AgentLifecycle
6. Migrate all agents to new system
7. Deprecate manual status.json updates

**Success Criteria:**
- [ ] All agent actions auto-update status.json
- [ ] Zero manual updates needed
- [ ] 100% status.json freshness
- [ ] Database always in sync

---

## üìä **SUCCESS METRICS**

### **Before (Current State):**
- ‚ùå Status.json update rate: ~40% (agents forget!)
- ‚ùå Stale status files: 3-5 out of 8 agents
- ‚ùå Database sync rate: ~30%
- ‚ùå Captain can't track: 60% of time
- ‚ùå Knowledge location: 5+ scattered places

### **After (Target State):**
- ‚úÖ Status.json update rate: 100% (automated!)
- ‚úÖ Stale status files: 0 (impossible with automation)
- ‚úÖ Database sync rate: 100% (automatic)
- ‚úÖ Captain can track: 100% of time
- ‚úÖ Knowledge location: 1 place (Swarm Brain Field Manual)

---

## üéØ **KEY BENEFITS**

### **1. Single Source of Truth**
- ‚úÖ All agent knowledge in ONE place (Swarm Brain Field Manual)
- ‚úÖ No more scattered docs
- ‚úÖ Easy to update and maintain
- ‚úÖ Versioned and searchable

### **2. Cycle-Based Enforcement** ‚ö°
- ‚úÖ Reminders EVERY cycle (not "daily" - CYCLE-based!)
- ‚úÖ Automated checks
- ‚úÖ Captain visibility
- ‚úÖ Violations caught immediately

### **3. Impossible to Forget**
- ‚úÖ Code enforces requirements
- ‚úÖ Agents can't skip status updates
- ‚úÖ Database always synced
- ‚úÖ Captain always has visibility

### **4. Scalable**
- ‚úÖ Add new agents easily
- ‚úÖ Update protocols in one place
- ‚úÖ Automated enforcement scales
- ‚úÖ No manual oversight needed

---

## üöÄ **IMMEDIATE NEXT STEPS**

### **Cycle 1: Start Now!**
1. Create `swarm_brain/agent_field_manual/` directory
2. Write 02_CYCLE_PROTOCOLS.md ‚ö° (CORRECTED: CYCLE not daily!)
3. Write 03_STATUS_JSON_COMPLETE_GUIDE.md
4. Update swarm_brain/knowledge_base.json

### **Cycle 2: Reminders**
1. Create pre_cycle_check.py
2. Test with Agent-1
3. Deploy to all agents

### **Cycle 3: Automation**
1. Create AgentLifecycle class
2. Integrate with messaging
3. Test end-to-end

---

## üìù **SUMMARY**

**The Problem:** Agent knowledge scattered across 5+ systems, no integration

**The Solution:** 3-Tier Unified System
1. **Tier 1:** Swarm Brain Field Manual (Single Source of Truth)
2. **Tier 2:** Cycle-based automated reminders (Every cycle enforcement)
3. **Tier 3:** Code-level automation (Impossible to forget)

**The Outcome:** 
- ‚úÖ 100% status.json freshness
- ‚úÖ 100% database sync
- ‚úÖ 100% Captain visibility
- ‚úÖ ZERO scattered knowledge
- ‚úÖ ZERO agent memory required

**Timeline:** 10 cycles to full deployment

---

**üêù UNIFIED AGENT KNOWLEDGE - ONE TRUTH, AUTOMATIC ENFORCEMENT!** ‚ö°

**#UNIFIED-SYSTEM #CYCLE-BASED #AUTOMATED-ENFORCEMENT #SWARM-BRAIN**

